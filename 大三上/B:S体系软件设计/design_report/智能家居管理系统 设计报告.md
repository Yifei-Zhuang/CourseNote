# 智能家居管理系统 设计报告

### 软工2002 庄毅非 3200105872

## 1. 设计概述

### 1.1 任务和目标

​	本项目是2022-2023秋冬学期《B/S 体系软件设计》的课程项目。旨在设计一个智能家居管理系统网站，能够实现用户的注册和登陆，场所的添加和删除，场所中房间的添加和删除，房间中户型图的上传和智能家居的添加，以及实现对智能家居状态的管理和删除。同时需要网站界面对用户友好，样式适配手机移动端，可以在手机浏览器和微信等应用内置的浏览器中友好显示，同时也需要提供必要的软件项目文档，使自己了解并掌握一套web应用开发技术和开发的总体流程。

​	本文档是该项目的系统设计文档，包含了系统的需求分析，系统的总体架构设计，以及数据库的设计和系统接口、界面原型的设计等内容，详细介绍了物联网设备应用网站的设计情况。该项目需要包含完整的web前后端，以及相关项目文档等内容，并且由一人独立完成。

### 1.2 运行环境

​	本项目采用前后端分离的架构，前端技术栈为reactjs + reduxjs + nextjs + material design，后端技术栈为gin-gonic + gorm + mysql，对服务器要求的部署环境如下：

- Node.js 14.0+
- Mysql 5.5+
- golang 1.18+



## 2. 功能模块和层次结构设计

###2.1 用户信息模块

![user](/Users/zhuangyifei/Desktop/tech_Learning/myhomework/third up/bs/design_report/assets/user.png)

### 2.2 家居管理模块

![jiajuguanli](/Users/zhuangyifei/Desktop/tech_Learning/myhomework/third up/bs/design_report/assets/jiajuguanli.jpg)





### 2.3 客户端项目层次架构



![client](/Users/zhuangyifei/Desktop/tech_Learning/myhomework/third up/bs/design_report/assets/client.jpg)

### 2.4 服务端项目层次架构

![server](/Users/zhuangyifei/Desktop/tech_Learning/myhomework/third up/bs/design_report/assets/server.png)



## 3. 类图

![devices](/Users/zhuangyifei/Desktop/tech_Learning/myhomework/third up/bs/design_report/assets/devices.png)



## 4. 数据词典

### 4.1 Users 表

| 字段名       | 类型         | 描述     | 备注     |
| ------------ | ------------ | -------- | -------- |
| userid       | bigint       | 用户id   | 自增主键 |
| phone number | varchar(100) | 手机号   | 唯一键   |
| username     | varchar(100) | 用户名   | 唯一键   |
| password     | longtext     | 用户密码 | 非空     |



### 4.2 Houses表（场所）

| 字段名      | 类型     | 描述       | 备注     |
| ----------- | -------- | ---------- | -------- |
| houseid     | bigint   | 场所id     | 自增主键 |
| userid      | bigint   | 所属用户id | 外键约束 |
| housename   | longtext | 场所名     | 非空     |
| description | longtext | 场所描述   | 非空     |
| roomcount   | bigint   | 拥有房间数 | 非负     |

### 4.3 Rooms表（房间）

| 字段名      | 类型     | 描述       | 备注     |
| ----------- | -------- | ---------- | -------- |
| roomid      | bigint   | id         | 自增主键 |
| userid      | bigint   | 所属用户id | 外键约束 |
| houseid     | bigint   | 所属场所id | 外键约束 |
| description | longtext | 房间描述   | 非空     |
| name        | longtext | 房间名     | 非空     |

### 4.4 devices表

| 字段名      | 类型       | 描述       | 备注             |
| ----------- | ---------- | ---------- | ---------------- |
| deviceid    | bigint     | id         | 自增主键         |
| devicename  | longtext   | 设备id     | 非空             |
| type        | longtext   | 设备类型   | 非空             |
| roomid      | bigint     | 所属房间id | 外键约束         |
| description | longtext   | 设备描述   |                  |
| status      | tinyint(1) | 设备状态   |                  |
| sensorvalue | bigint     | 传感器值   |                  |
| brightness  | bigint     | 灯亮度     |                  |
| position    | bigint     | 设备位置   | **用于前端渲染** |
| houseid     | bigint     | 所属场所id | 外键约束         |
| userid      | bigint     | 所属用户id | 外键约束         |



## 5. 系统接口设计

​	系统的接口主要是前后端进行交互时候的接口，这里前端采用 axios 库与后端进行异步的交互，在后端会设置一系列的路由映射来处理前端的各个请求，以下是具体的api设计。

​	**请注意，由于当前系统仍处于开发阶段，最终成品的api的定义和数目可能和本设计文档中的接口定义略有差异。**

​	以下的返回值都以json为返回格式。

### 5.1 用户信息相关接口

#### 5.1.1 用户注册

| URL        | /user/register                                               |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | POST                                                         |
| 请求格式   | {<br /> phoneNumber: 17346399235,<br /> userName: tester,<br /> password: 123456<br />} |
| 返回值类型 | code为200表示注册成功，否则注册失败，在返回值的error属性上注明失败原因（如手机号重复） |
| 借口简介   | 用于用户注册新账号时使用，在数据表中添加新用户的信息。       |

#### 5.1.2 用户登陆

| URL        | /user/login                                                  |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | POST                                                         |
| 请求格式   | {<br /> userName: tester,<br /> password: 123456<br />}      |
| 返回值类型 | code为200表示登陆成功，并返回用户id；否则登陆失败，在返回值的error属性上注明失败原因（如手机号重复） |
| 借口简介   | 用于用户登陆时使用                                           |

### 5.1.3 用户修改密码

| URL        | /user/changePassword                                         |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  username:"tester",<br />  password:"123333"<br />} |
| 返回值类型 | code为200表示修改成功，否则修改失败，在返回值的error属性上注明失败原因（如手机号重复） |
| 借口简介   | 用于用户修改密码时使用                                       |

### 5.2 场所管理相关接口

#### 5.2.1 添加场所

| URL        | /house/add                                                   |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | POST                                                         |
| 请求格式   | {<br />  userId:"1",<br />  houseName:"曹楼"<br />  description:"玉泉校区的一个教学楼"<br />} |
| 返回值类型 | code为200表示添加成功，否则添加失败，在返回值的error属性上注明失败原因 |
| 借口简介   | 用于用户添加场所时使用                                       |

#### 5.2.2 获得用户名下所有场所

| URL        | /house/all                                |
| ---------- | ----------------------------------------- |
| 请求方法   | GET                                       |
| 请求格式   | params:{<br />  username:"tester",<br />} |
| 返回值类型 | 用户名下的场所列表，格式为json            |
| 借口简介   | 用于前端渲染使用                          |

#### 5.2.3 删除场所

| URL        | /house/delete                                                |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  hosueid:"1",<br />}                          |
| 返回值类型 | code为200表示删除成功，否则删除失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于用户删除场所使用                                         |

### 5.3 房间管理接口

#### 5.3.1 添加房间

| URL        | /room/add                                                    |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | POST                                                         |
| 请求格式   | {<br />  hosueid:"1",<br />  userid:"1",<br />  name:"西104"<br />  description:"一个上课教室"<br />} |
| 返回值类型 | code为200表示创建成功，并返回创建成功的字符串;否则在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于用户创建房间使用                                         |

#### 5.3.2 获取场所对应的房间列表

| URL        | /room/add                                                    |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  hosueid:"1",<br />}                          |
| 返回值类型 | 该houseid对应的场所名下的所有房间的信息所组成的列表，以json格式返回 |
| 借口简介   | 前端渲染使用                                                 |

#### 5.3.3 删除房间

| URL        | /room/delete                                                 |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  roomid:"1",<br />}                           |
| 返回值类型 | code为200表示删除成功，并返回删除成功的消息；否则删除失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于用户删除房间使用                                         |

#### 5.3.4 获取单个房间的信息

| URL        | /room/get                             |
| ---------- | ------------------------------------- |
| 请求方法   | GET                                   |
| 请求格式   | params:{<br />  roomid:"1",<br />}    |
| 返回值类型 | 200响应代码，并返回json格式的房间信息 |
| 借口简介   | 用于前端渲染使用                      |

### 5.4 设备管理相关接口

#### 5.4.1 添加设备

| URL        | /device/add                                                  |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | POST                                                         |
| 请求格式   | {<br />  type:"door",<br />  position:"123",<br />  roomid:"1",<br />  deviceName:"日光灯",<br />  description:"一个日光灯",<br />  houseid:"1"<br />} |
| 返回值类型 | code为200表示创建成功，并返回创建成功的消息；否则创建失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于用户创建设备使用                                         |

#### 5.4.2 获取给定房间的所有设备

| URL        | /device/get                                           |
| ---------- | ----------------------------------------------------- |
| 请求方法   | GET                                                   |
| 请求格式   | params:{<br />  roomid:"1",<br />}                    |
| 返回值类型 | 200响应代码，返回该房间对应的所有设备列表，格式为json |
| 借口简介   | 用于前端渲染使用                                      |

#### 5.4.3 删除设备

| URL        | /device/delete                                               |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  deviceId:"1",<br />}                         |
| 返回值类型 | code为200表示删除成功，否则删除失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于用户删除设备使用                                         |

#### 5.4.4 获取单个设备详细信息

| URL        | /device/getSingle                                            |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  deviceId:"1",<br />}                         |
| 返回值类型 | code为200表示获取成功，并返回json格式的设备信息；否则获取失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 前端渲染使用                                                 |

#### 5.4.5 设备状态管理

| URL        | /device/getSingle                                            |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  type:"door",<br />  deviceId:"1",<br />  status:"true",<br />  // 这里传输的字段不一定都是status，要视设备而定，比如需要修改等的亮度，那么传输的字段就是`lightness`<br />} |
| 返回值类型 | code为200表示修改成功，否则修改失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于用户管理设备（比如开关门，开关灯）使用                   |

### 5.5 户型图相关接口

#### 5.5.1 上传户型图

| URL        | /image/upload                                                |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | POST                                                         |
| 请求格式   | {<br />  roomId:"1",<br />  image:"base64编码的图片信息",<br />} |
| 返回值类型 | code为200表示上传成功，否则上传失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于用户上传房间户型图使用                                   |

#### 5.5.2 获取户型图

| URL        | /image/get                                                   |
| ---------- | ------------------------------------------------------------ |
| 请求方法   | GET                                                          |
| 请求格式   | params:{<br />  roomId:"1",<br />}                           |
| 返回值类型 | code为200表示获取成功，并返回房间对应的户型图；否则删除失败，在返回值的error属性上注明失败原因（如缺失字段） |
| 借口简介   | 用于前端渲染户型图使用                                       |



## 6. 系统界面原型

​	系统的界面原型设计如下所示，**最终成品和界面原型略有差异**。

​	注:该设计报告完成于最终网站成形之前，因此最终许多地方都与系统界面原型设计有较大的差异。以下界面原型仅供参考。

### 6.1 欢迎页面

![image-20221023114126976](../../../../../../Library/Application Support/typora-user-images/image-20221023114126976.png)

### 6.2 登陆页面

![image-20221023114151716](../../../../../../Library/Application Support/typora-user-images/image-20221023114151716.png)

### 6.3 注册页面

![image-20221023114212506](../../../../../../Library/Application Support/typora-user-images/image-20221023114212506.png)



### 6.4 网站首页

![image-20221023114317041](../../../../../../Library/Application Support/typora-user-images/image-20221023114317041.png)



### 6.5 个人信息页面

![image-20221023114345469](../../../../../../Library/Application Support/typora-user-images/image-20221023114345469.png)



### 6.6 场所信息管理页面

![image-20221023114433209](../../../../../../Library/Application Support/typora-user-images/image-20221023114433209.png)



### 6.7 场所房间管理页面

![image-20221023114449520](../../../../../../Library/Application Support/typora-user-images/image-20221023114449520.png)



### 6.8 房间管理页面

![image-20221023114738614](../../../../../../Library/Application Support/typora-user-images/image-20221023114738614.png)



### 6.9 设备信息列表



![image-20221023114758652](../../../../../../Library/Application Support/typora-user-images/image-20221023114758652.png)



### 6.10 设备信息管理页

![image-20221023114816591](../../../../../../Library/Application Support/typora-user-images/image-20221023114816591.png)





## 7. 附录

### 7.1 项目时间安排

| 时间段      | 计划进度                     |
| ----------- | ---------------------------- |
| 2022.10     | 完成项目前端设计和开发       |
| 2022.11     | 完成项目后端设计和开发       |
| 2022.12上旬 | 完成项目开发，进行测试       |
| 2022.12下旬 | 进一步完善项目，编写各个文档 |

### 7.2 备注

​	本设计文档中未竟之事均以最后提交的系统源代码和文档为准。























